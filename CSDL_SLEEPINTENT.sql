CREATE DATABASE SLEEPINTENT
GO
USE SLEEPINTENT
GO
CREATE TABLE PHONG
(
	MAPHONG CHAR(10) not null,
	TENPHONG NVARCHAR(20) not null,
	GIAPHONG INTEGER not null,
	CONSTRAINT P_MAPHONG_PK PRIMARY KEY (MAPHONG)
);
GO

CREATE TABLE DICHVU
(
	MADV CHAR(10) not null,
	TENDV NVARCHAR(20) not null,
	DONGIA INTEGER not null,
	CONSTRAINT DV_MADV_PK PRIMARY KEY (MADV)
);
GO
CREATE TABLE KHACHHANG
(
	MAKH CHAR(10) not null,
	MAPHONG CHAR(10) not null,
	TENKH NVARCHAR(20) not null,
	NAMSINH DATETIME,
	SDT NVARCHAR(15) not null,
	CONSTRAINT KH_MAKH_PK PRIMARY KEY (MAKH),
	CONSTRAINT KH_MAPHONG_FK FOREIGN KEY(MAPHONG) REFERENCES PHONG(MAPHONG)
);
GO
CREATE TABLE SUDUNGDV
(
	MAKH CHAR(10) not null,
	MADV CHAR(10) not null,
	SOLUONG INTEGER not null,
	GIADV INTEGER,
	CONSTRAINT SD_MADVKH_PK PRIMARY KEY(MAKH,MADV),
	CONSTRAINT SD_MADV_FK FOREIGN KEY(MADV) REFERENCES DICHVU(MADV),
	CONSTRAINT SD_MAKH_FK FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)
);
GO

INSERT INTO PHONG VALUES ('P1',N'TÊN PHÒNG 1',150000)
INSERT INTO PHONG VALUES ('P2',N'TÊN PHÒNG 2',180000)
INSERT INTO PHONG VALUES ('P3',N'TÊN PHÒNG 3',200000)
INSERT INTO PHONG VALUES ('P4',N'TÊN PHÒNG 4',250000)
INSERT INTO PHONG VALUES ('P5',N'TÊN PHÒNG 5',300000)

INSERT INTO DICHVU VALUES ('DV1',N'TÊN DỊCH VỤ 1',10000)
INSERT INTO DICHVU VALUES ('DV2',N'TÊN DỊCH VỤ 2',20000)
INSERT INTO DICHVU VALUES ('DV3',N'TÊN DỊCH VỤ 3',30000)
INSERT INTO DICHVU VALUES ('DV4',N'TÊN DỊCH VỤ 4',40000)
INSERT INTO DICHVU VALUES ('DV5',N'TÊN DỊCH VỤ 5',50000)
INSERT INTO DICHVU VALUES ('DV6',N'TÊN DỊCH VỤ 6',60000)

INSERT INTO KHACHHANG VALUES ('KH1','P1',N'TÊN KH 1','01/19/1996','0987931342')
INSERT INTO KHACHHANG VALUES ('KH2','P2',N'TÊN KH 2','02/19/1996','0987931342')
INSERT INTO KHACHHANG VALUES ('KH3','P3',N'TÊN KH 3','03/19/1996','0987931342')
INSERT INTO KHACHHANG VALUES ('KH4','P4',N'TÊN KH 4','04/19/1996','0987931342')
INSERT INTO KHACHHANG VALUES ('KH5','P5',N'TÊN KH 5','05/19/1996','0987931342')

INSERT INTO SUDUNGDV VALUES ('KH1','DV1',2,'')
INSERT INTO SUDUNGDV VALUES ('KH1','DV2',1,'')
INSERT INTO SUDUNGDV VALUES ('KH1','DV3',2,'')
INSERT INTO SUDUNGDV VALUES ('KH4','DV1',2,'')
INSERT INTO SUDUNGDV VALUES ('KH3','DV1',2,'')
INSERT INTO SUDUNGDV VALUES ('KH2','DV1',2,'')
INSERT INTO SUDUNGDV VALUES ('KH2','DV6',2,'')
INSERT INTO SUDUNGDV VALUES ('KH3','DV5',2,'')
INSERT INTO SUDUNGDV VALUES ('KH3','DV3',1,'')

UPDATE SUDUNGDV
SET SUDUNGDV.GIADV = DICHVU.DONGIA*SUDUNGDV.SOlUONG
FROM dbo.SUDUNGDV JOIN dbo.DICHVU ON SUDUNGDV.MADV = DICHVU.MADV


Select SUDUNGDV.MAKH,DICHVU.TENDV,SUDUNGDV.SOLUONG,SUDUNGDV.GIADV
From SUDUNGDV,DICHVU,KHACHHANG
Where SUDUNGDV.MADV=DICHVU.MADV and SUDUNGDV.MAKH = KHACHHANG.MAKH and SUDUNGDV.MAKH='KH1'

Select *
From PHONG,KHACHHANG
Where PHONG.MAPHONG = KHACHHANG.MAPHONG

select TENDV
from DICHVU
where TENDV!={'TÊN DỊCH VỤ 1','TÊN DỊCH VỤ 2'}

DROP DATABASE SLEEPINTENT